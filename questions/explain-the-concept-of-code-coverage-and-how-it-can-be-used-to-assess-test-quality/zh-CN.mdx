---
title: 解释代码覆盖率的概念以及如何使用它来评估测试质量
---

## TL;DR

代码覆盖率是一个衡量测试套件运行时执行代码百分比的指标。它通过识别代码库中未测试的部分来帮助评估测试的质量。较高的代码覆盖率通常表明测试更彻底，但并不能保证没有错误。可以使用 Istanbul 或 Jest 等工具来衡量代码覆盖率。

***

## 什么是代码覆盖率？

代码覆盖率是一个软件测试指标，用于确定在自动化测试期间执行的代码量。它提供了关于代码库的哪些部分正在被测试以及哪些部分没有被测试的见解。

### 代码覆盖率的类型

1. **语句覆盖率**：衡量已执行的代码中的语句数量。
2. **分支覆盖率**：衡量每个分支（例如，`if` 和 `else` 块）是否已被执行。
3. **函数覆盖率**：衡量代码中每个函数是否已被调用。
4. **行覆盖率**：衡量已执行的代码行数。
5. **条件覆盖率**：衡量每个布尔子表达式是否已被评估为真和假。

### 示例

考虑以下 JavaScript 函数：

```js
function isEven(num) {
  if (num % 2 === 0) {
    return true;
  } else {
    return false;
  }
}
```

此函数的测试套件可能如下所示：

```js
test('isEven returns true for even numbers', () => {
  expect(isEven(2)).toBe(true);
});

test('isEven returns false for odd numbers', () => {
  expect(isEven(3)).toBe(false);
});
```

在此测试套件上运行代码覆盖率工具将显示 100% 的语句、分支、函数和行覆盖率，因为代码的所有部分都已执行。

## 如何衡量代码覆盖率

### 工具

1. **Istanbul**：一个流行的 JavaScript 代码覆盖率工具。
2. **Jest**：一个测试框架，包含内置的代码覆盖率报告。
3. **Karma**：一个测试运行器，可以配置为使用 Istanbul 进行代码覆盖率。

### 使用 Jest 的示例

要使用 Jest 衡量代码覆盖率，您可以在运行测试时添加 `--coverage` 标志：

```bash
jest --coverage
```

这将生成一个覆盖率报告，显示测试覆盖代码的百分比。

## 使用代码覆盖率评估测试质量

### 优点

* **识别未测试的代码**：帮助找到未被测试覆盖的代码库部分。
* **改进测试套件**：鼓励编写更全面的测试。
* **增加信心**：更高的覆盖率可以增加对代码稳定性的信心。

### 局限性

* **虚假的安全感**：高覆盖率并不能保证没有错误。
* **质量胜于数量**：100% 的覆盖率并不意味着测试质量高。测试还应检查边缘情况和潜在错误。

## 延伸阅读

* [Istanbul documentation](https://istanbul.js.org/)
* [Jest code coverage](https://jestjs.io/docs/en/coverage)
* [Karma coverage](https://karma-runner.github.io/6.3/intro/installation.html)
